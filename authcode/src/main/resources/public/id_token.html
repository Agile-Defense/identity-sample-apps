<!DOCTYPE html>
<html>
<head lang="en">
  <meta charset="UTF-8"/>
  <title></title>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
  <script type="text/javascript">
    function getFragment(pattern) {
      var matcher = new RegExp(pattern + '=([^&]+)');
      var found = matcher.exec(window.location.hash);
      if (!!found) {
        return found[1];
      } else {
        return null;
      }
    }

    function prettyToken(token) {
      if (!!token) {
        return JSON.stringify(JSON.parse(atob(token.split('\.')[1])), null, '  ');
      } else {
        return '';
      }
    }

    function hasCode() {
      return !!getFragment("code")
    }

    $(function() {
      console.log("id_token : " + prettyToken(getFragment("id_token")));
      debugger;
      $.ajax({
        type: "GET",
        url: '/save_id_token?id_token=' + getFragment("id_token"),
        dataType: "text/HTML",
        success: function(data) {
          console.log('success')
        }
      });

      if (hasCode()) {
        window.location.href = "http://localhost:8888/login?code=" + getFragment("code") + "&state=" + getFragment("state") + "&id_token=" + getFragment("id_token");
      }
    });
  </script>
</head>
<body>
<form></form>
</body>
</html>
